<!DOCTYPE html>
<html lang="uk">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>–°–µ–∫—Ä–µ—Ç–Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫–∞</title>
        <link rel="stylesheet" href="/css/secret.css" />
    </head>
    <body>
        <div class="loading" id="loading">üîÑ –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</div>

        <div
            class="container secret-content"
            id="secretContent"
            style="display: none"
        >
            <div class="secret-emoji">üîê</div>
            <h1>–°–µ–∫—Ä–µ—Ç–Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫–∞</h1>

            <div class="welcome">
                <h2>–í—ñ—Ç–∞—î–º–æ, <span id="username"></span>!</h2>
                <p>–í–∏ —É—Å–ø—ñ—à–Ω–æ —É–≤—ñ–π—à–ª–∏ –¥–æ —Å–µ–∫—Ä–µ—Ç–Ω–æ—ó –∑–æ–Ω–∏</p>
            </div>

            <div class="info-box">
                <h3>üìä –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –≤–∞—à –∞–∫–∞—É–Ω—Ç:</h3>
                <ul>
                    <li>
                        <strong>üë§ –Ü–º'—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞:</strong>
                        <span id="userUsername"></span>
                    </li>
                    <li>
                        <strong>üìß Email:</strong> <span id="userEmail"></span>
                    </li>
                    <li><strong>üÜî ID:</strong> <span id="userId"></span></li>
                    <li>
                        <strong>üìÖ –î–∞—Ç–∞ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó:</strong>
                        <span id="userCreated"></span>
                    </li>
                </ul>
            </div>

            <div class="info-box">
                <h3>üéâ –í–∏ –æ—Ç—Ä–∏–º–∞–ª–∏ –¥–æ—Å—Ç—É–ø!</h3>
                <p>
                    –¶–µ –ø—Ä–∏–≤–∞—Ç–Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫–∞, –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç—ñ–ª—å–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–∏–º
                    –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞–º.
                </p>
            </div>

            <div class="buttons">
                <a href="/" class="btn btn-primary">–ù–∞ –≥–æ–ª–æ–≤–Ω—É</a>
                <button onclick="logout()" class="btn btn-danger">–í–∏–π—Ç–∏</button>
            </div>
        </div>

        <script>
            async function logout() {
                try {
                    const response = await fetch('/api/logout', {
                        method: 'POST',
                        credentials: 'include',
                    });
                    if (response.ok) {
                        window.location.href = '/';
                    } else {
                        alert('–ü–æ–º–∏–ª–∫–∞ –≤–∏—Ö–æ–¥—É');
                    }
                } catch {
                    alert('–ü–æ–º–∏–ª–∫–∞ –≤–∏—Ö–æ–¥—É');
                }
            }

            async function checkAuth() {
                try {
                    const response = await fetch('/api/me', {
                        credentials: 'include',
                    });

                    if (!response.ok) {
                        window.location.href = '/login';
                        return;
                    }

                    const data = await response.json();
                    const user = data.user;

                    // –ë–µ–∑–ø–µ—á–Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞
                    if (!user) {
                        window.location.href = '/login';
                        return;
                    }

                    // –í–∏–≤—ñ–¥ –¥–∞–Ω–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
                    document.getElementById('username').textContent =
                        user.username || '–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á';
                    document.getElementById('userUsername').textContent =
                        user.username || '-';
                    document.getElementById('userEmail').textContent =
                        user.email || '-';
                    document.getElementById('userId').textContent =
                        user._id || '-';

                    if (user.createdAt) {
                        const createdDate = new Date(user.createdAt);
                        document.getElementById('userCreated').textContent =
                            createdDate.toLocaleString('uk-UA', {
                                year: 'numeric',
                                month: 'long',
                                day: 'numeric',
                                hour: '2-digit',
                                minute: '2-digit',
                            });
                    } else {
                        document.getElementById('userCreated').textContent =
                            '-';
                    }

                    // –ü–æ–∫–∞–∑ —Å—Ç–æ—Ä—ñ–Ω–∫–∏ –ø—ñ—Å–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è
                    document.getElementById('loading').style.display = 'none';
                    document.getElementById('secretContent').style.display =
                        'block';
                } catch (err) {
                    console.error('–ü–æ–º–∏–ª–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó:', err);
                    window.location.href = '/login';
                }
            }

            // –í–∏–∫–ª–∏–∫ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ
            checkAuth();
        </script>
    </body>
</html>
